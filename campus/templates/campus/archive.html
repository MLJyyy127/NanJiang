{% extends 'base.html' %}
{% load static %}

{% block title %}æ ¡å²æ¡£æ¡ˆ - å—æ±Ÿå¤§å­¦{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'campus/css/archive.css' %}">
{% endblock %}

{% block content %}
<div class="archive-container">
    <!-- æ¡£æ¡ˆå®¤è­¦å‘Šæ¨ªå¹… -->
    <div class="archive-banner">
        <div class="warning-icon">âš </div>
        <div class="warning-text">
            <h3>ç»å¯†æ¡£æ¡ˆå®¤</h3>
            <p>ä»¥ä¸‹æ¡£æ¡ˆå‡ä¸ºå—æ±Ÿå¤§å­¦å†å²ä¸Šæœªè§£æ‚¬æ¡ˆï¼Œä»…é™æˆæƒäººå‘˜æŸ¥é˜…</p>
        </div>
        <div class="security-level">
            <span class="security-badge">æœ€é«˜æœºå¯†</span>
            <span class="access-code">è®¿é—®ä»£ç ï¼šNJ-1995-â–ˆâ–ˆâ–ˆ</span>
        </div>
    </div>

    <!-- æ¡£æ¡ˆå¯¼èˆª -->
    <div class="archive-nav">
        <div class="nav-tabs">
            <a href="{% url 'campus:archive_index' %}" class="nav-tab {% if request.path == '/campus/archive/' %}active{% endif %}">å…¨éƒ¨æ¡ˆä»¶</a>
            <a href="{% url 'campus:archive_category' 'unsolved' %}" class="nav-tab {% if 'unsolved' in request.path %}active{% endif %}">æœªè§£ä¹‹è°œ</a>
            <a href="{% url 'campus:archive_category' 'student' %}" class="nav-tab {% if 'student' in request.path %}active{% endif %}">å­¦ç”Ÿæ¡ˆä»¶</a>
            <a href="{% url 'campus:archive_category' 'faculty' %}" class="nav-tab {% if 'faculty' in request.path %}active{% endif %}">æ•™èŒå·¥æ¡ˆä»¶</a>
            <a href="{% url 'campus:archive_category' 'building' %}" class="nav-tab {% if 'building' in request.path %}active{% endif %}">å»ºç­‘ç›¸å…³</a>
        </div>
        <div class="search-box">
            <input type="text" placeholder="æœç´¢æ¡£æ¡ˆå…³é”®è¯..." id="archive-search">
            <button onclick="searchArchives()">ğŸ”</button>
        </div>
    </div>

    <!-- äº”ä¸ªææ€–æ‚¬ç–‘æ¡ˆä»¶æ¡£æ¡ˆ - ä½¿ç”¨å¾ªç¯åŠ¨æ€ç”Ÿæˆ -->
    <div class="archives-grid">
        {% for case in cases %}
        <div class="archive-card" data-category="{{ case.category }}" data-status="{{ case.status }}">
            <div class="archive-header">
                <span class="archive-id">æ¡£æ¡ˆç¼–å·ï¼š{{ case.case_id }}</span>
                <span class="archive-status {{ case.status }}">
                    {% if case.status == 'unsolved' %}æœªè§£å†³
                    {% elif case.status == 'sealed' %}å·²å°å­˜
                    {% elif case.status == 'investigating' %}è°ƒæŸ¥ä¸­
                    {% endif %}
                </span>
            </div>
            <h3 class="archive-title">{{ case.title }}</h3>
            <div class="archive-meta">
                <span class="meta-item"><strong>å‘ç”Ÿæ—¶é—´ï¼š</strong>{{ case.date }}</span>
                <span class="meta-item"><strong>åœ°ç‚¹ï¼š</strong>{{ case.location }}</span>
                <span class="meta-item"><strong>æ¶‰åŠäººå‘˜ï¼š</strong>{{ case.persons }}</span>
            </div>
            <div class="archive-content">
                <!-- æ ¹æ®æ¡ˆä»¶IDæ˜¾ç¤ºä¸åŒçš„æ‘˜è¦å†…å®¹ -->
                {% if case.id == 1 %}
                <p>1995å¹´10æœˆ17æ—¥æ·±å¤œï¼Œä¸‰åå†å²ç³»å­¦ç”Ÿåœ¨è€å›¾ä¹¦é¦†B1å±‚çš„"ç¬¬ä¸ƒè—ä¹¦å®¤"ï¼ˆè¯¥å®¤åœ¨å®˜æ–¹å¹³é¢å›¾ä¸­ä¸å­˜åœ¨ï¼‰æŸ¥é˜…æ¡£æ¡ˆæ—¶çªç„¶æ¶ˆå¤±ã€‚ç›‘æ§æ˜¾ç¤ºä»–ä»¬è¿›å…¥B1å±‚èµ°å»Šåï¼Œå†ä¹Ÿæ²¡æœ‰å‡ºæ¥ã€‚</p>
                {% elif case.id == 2 %}
                <p>1998å¹´è‡³2002å¹´é—´ï¼Œä¸ƒåéŸ³ä¹ç³»å­¦ç”Ÿåœ¨å•ç‹¬ç»ƒä¹ æ—¶é­é‡ç›¸åŒç»å†ï¼šåˆå¤œ12ç‚¹åï¼Œé’¢ç´ä¼šè‡ªåŠ¨å¼¹å¥è‚–é‚¦çš„ã€Šè‘¬ç¤¼è¿›è¡Œæ›²ã€‹ï¼Œæ¼”å¥è€…ä½ç½®ç©ºæ— ä¸€äººã€‚æ‰€æœ‰ç›®å‡»è€…éƒ½åœ¨ä¸€å‘¨å†…é€€å­¦ã€‚</p>
                {% elif case.id == 3 %}
                <p>1987å¹´ï¼Œé—ä¼ å­¦å¼ æ•™æˆè¿›è¡Œç§˜å¯†å®éªŒæ—¶å‘ç”Ÿæ³„éœ²ã€‚æ¬¡æ—¥æ—©æ™¨ï¼Œå®éªŒå®¤è¢«å‘ç°æ—¶ï¼Œä¸‰äººå·²ä¸è§è¸ªå½±ï¼Œåªç•™ä¸‹å¤§é‡ä¸ç¬¦åˆå·²çŸ¥ç”Ÿç‰©ç‰¹å¾çš„ç»†èƒæ ·æœ¬å’Œä¸€æ®µä»¤äººä¸å®‰çš„å½•éŸ³ã€‚</p>
                {% elif case.id == 4 %}
                <p>æ¢…å›­3å·æ¥¼åœ¨è®¾è®¡ä¸Šåªæœ‰12é—´å®¿èˆï¼Œä½†å¤šåå­¦ç”ŸæŠ¥å‘Šåœ¨æ·±å¤œçœ‹åˆ°ç¬¬13é—´çš„é—¨ç‰Œã€‚è¿›å…¥è€…ä¼šç»å†æ—¶é—´é”™ä¹±ï¼Œå‡ºæ¥åå‘ç°è‡ªå·±å¤±è¸ªäº†æ•°å°æ—¶ç”šè‡³æ•°å¤©ï¼Œä¸”å¯¹æœŸé—´ç»å†æ¯«æ— è®°å¿†ã€‚</p>
                {% elif case.id == 5 %}
                <p>å¤œé—´å·¡é€»çš„ä¿å®‰ç‹å»ºå›½æŠ¥å‘Šï¼Œé•œæ¹–ä¸­å¿ƒåœ¨æ— é£æƒ…å†µä¸‹äº§ç”Ÿæ¼©æ¶¡ï¼Œå¹¶ä»ä¸­ä¼ å‡º"ç±»ä¼¼å¤šäººä½è¯­"çš„å£°éŸ³ã€‚å£°çº³æ¢æµ‹æ˜¾ç¤ºæ¹–åº•æœ‰å¤§å‹äººå·¥ç»“æ„ï¼Œä½†å†å²è®°å½•ä¸­ä»æœªæåŠæ­¤å¤„æœ‰å»ºç­‘ã€‚</p>
                {% else %}
                <p>{{ case.content|striptags|truncatechars:150 }}</p>
                {% endif %}
                
                <!-- æ˜¾ç¤ºå‰3æ¡çº¿ç´¢ -->
                {% if case.clues %}
                <div class="archive-clue">
                    <h4>ğŸ“ ç°åœºçº¿ç´¢ï¼š</h4>
                    <ul>
                        {% for clue in case.clues|slice:":3" %}
                        <li>{{ clue }}</li>
                        {% endfor %}
                        {% if case.clues|length > 3 %}
                        <li>...è¿˜æœ‰ {{ case.clues|length|add:"-3" }} æ¡çº¿ç´¢</li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
                
                <!-- æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ -->
                {% if case.warning and case.id == 1 %}
                <div class="archive-warning">
                    <strong>âš  è®¿é—®è­¦å‘Šï¼š</strong> {{ case.warning }}
                </div>
                {% elif case.warning and case.id == 3 %}
                <div class="archive-warning danger">
                    <strong>â˜£ ç”Ÿç‰©å±å®³è­¦å‘Šï¼š</strong> {{ case.warning }}
                </div>
                {% elif case.warning and case.id == 5 %}
                <div class="archive-warning">
                    <strong>âš  æœ€æ–°å‘ç°ï¼š</strong> {{ case.warning }}
                </div>
                {% endif %}
                
                <!-- æ˜¾ç¤ºå¤‡æ³¨ä¿¡æ¯ -->
                {% if case.note and case.id == 2 %}
                <div class="archive-note">
                    <strong>ğŸ“Œ è°ƒæŸ¥ç¬”è®°ï¼š</strong> {{ case.note }}
                </div>
                {% elif case.note and case.id == 4 %}
                <div class="archive-note">
                    <strong>ğŸ“Œ ç°è¡Œè§„å®šï¼š</strong> {{ case.note }}
                </div>
                {% endif %}
            </div>
            <div class="archive-footer">
                <a href="{% url 'campus:archive_detail' case.id %}" class="btn-details">æŸ¥çœ‹è¯¦æƒ…</a>
                <div class="archive-tags">
                    {% for tag in case.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="no-results">
            <h3>æš‚æ— æ¡ˆä»¶æ¡£æ¡ˆ</h3>
            <p>å½“å‰æ²¡æœ‰å¯æ˜¾ç¤ºçš„æ¡£æ¡ˆè®°å½•ã€‚</p>
        </div>
        {% endfor %}
    </div>

    <!-- æ¡£æ¡ˆç»Ÿè®¡ -->
    <div class="archive-stats">
        <div class="stat-card">
            <div class="stat-number">{{ total_cases }}</div>
            <div class="stat-label">æ‚¬æ¡ˆæ€»æ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ unsolved_cases }}</div>
            <div class="stat-label">æœªè§£å†³</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ involved_persons }}</div>
            <div class="stat-label">æ¶‰åŠäººå‘˜</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ earliest_year }}</div>
            <div class="stat-label">æœ€æ—©æ¡ˆä»¶</div>
        </div>
    </div>
</div>

<!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
<div id="detailModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modalContent"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'campus/js/archive.js' %}"></script>
<script>
    // æœç´¢åŠŸèƒ½
    function searchArchives() {
        const searchTerm = document.getElementById('archive-search').value.toLowerCase();
        const cards = document.querySelectorAll('.archive-card');
        
        cards.forEach(card => {
            const title = card.querySelector('.archive-title').textContent.toLowerCase();
            const content = card.querySelector('.archive-content').textContent.toLowerCase();
            const tags = Array.from(card.querySelectorAll('.tag')).map(tag => tag.textContent.toLowerCase()).join(' ');
            
            if (title.includes(searchTerm) || content.includes(searchTerm) || tags.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    // æŒ‰Enteré”®æœç´¢
    document.getElementById('archive-search').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchArchives();
        }
    });
    
    // è¿‡æ»¤åŠŸèƒ½ï¼ˆå¯ä»¥æ ¹æ®çŠ¶æ€ç­›é€‰ï¼‰
    function filterArchives(status) {
        const cards = document.querySelectorAll('.archive-card');
        
        cards.forEach(card => {
            if (status === 'all' || card.getAttribute('data-status') === status) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}